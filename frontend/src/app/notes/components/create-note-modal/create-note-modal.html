<!-- Backdrop - Cambia bg-black/60 a bg-black/80 o bg-black/90 -->
<div
  class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 animate-in fade-in duration-300"
>
  <!-- Modal Container - Cambia bg-card/95 a bg-card -->
  <div
    class="relative bg-card border border-border/40 rounded-xl w-full max-w-lg mx-4 shadow-2xl animate-in zoom-in slide-in-from-top-4 duration-300"
  >
    <!-- Close Button -->
    <button
      (click)="closeModal()"
      class="absolute top-4 right-4 text-muted-foreground hover:text-foreground transition-colors duration-200 cursor-pointer"
      aria-label="Close modal"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
      >
        <path
          fill="none"
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="m18 6l-6 6m0 0l-6 6m6-6l6 6m-6-6L6 6"
        />
      </svg>
    </button>

    <!-- Modal Content -->
    <form class="p-6" [formGroup]="newNoteForm">
      <h2 class="text-2xl font-bold text-primary mb-6">
        {{ isEditMode() ? 'Edit Note' : 'New Note' }}
      </h2>

      <!-- Title Input -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-foreground mb-2"
          >Title</label
        >
        <input
          formControlName="title"
          type="text"
          placeholder="Note title..."
          class="w-full px-4 py-2.5 bg-background/50 border border-border/40 rounded-lg text-foreground placeholder:text-muted-foreground outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
        />
      </div>

      <!-- Content Textarea -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-foreground mb-2"
          >Description</label
        >
        <textarea
          formControlName="description"
          placeholder="Write your note here..."
          rows="6"
          class="w-full px-4 py-2.5 bg-background/50 border border-border/40 rounded-lg text-foreground placeholder:text-muted-foreground resize-none outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
        ></textarea>
      </div>

      <!-- Categories Section -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-foreground mb-2"
          >Categories</label
        >

        <!-- Add Custom Category -->
        <div class="flex gap-2 mb-3">
          <input
            formControlName="customCategory"
            type="text"
            placeholder="Add custom category..."
            class="flex-1 px-4 py-2 bg-background/50 border border-border/40 rounded-lg text-sm text-foreground placeholder:text-muted-foreground outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
          />
          <button
            type="button"
            (click)="addCategoryToList()"
            class="px-4 py-2 bg-card/60 border border-border/40 rounded-lg text-foreground hover:bg-background/50 transition-colors duration-200 cursor-pointer"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
            >
              <path fill="currentColor" d="M11 13H5v-2h6V5h2v6h6v2h-6v6h-2z" />
            </svg>
          </button>
        </div>

        <!-- Category Pills -->
        <div class="flex flex-wrap gap-2">
          @for (category of availableCategories(); track category.name) {

          <!-- CategorÃ­a NO seleccionada -->
          <button
            (click)="changeIsSelectionatedValue(category.name)"
            type="button"
            class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm font-medium text-foreground border border-border/40 hover:scale-105 transition-all duration-200 cursor-pointer"
            [ngClass]="
            {
              'bg-primary text-white': category.isSelectionated,
              'bg-card/60 text-foreground': !category.isSelectionated
            }"
          >
            <span>{{category.name}}</span>
            @if (category.isSelectionated) {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              class="hover:scale-110 transition-transform"
            >
              <path
                fill="none"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m18 6l-6 6m0 0l-6 6m6-6l6 6m-6-6L6 6"
              />
            </svg>
            }
          </button>
          }
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex justify-end gap-3">
        <button
          (click)="closeModal()"
          type="button"
          class="px-5 py-2 rounded-lg bg-card/60 border border-border/40 text-foreground hover:bg-background/50 transition-all duration-200 cursor-pointer"
        >
          Cancel
        </button>
        <button
          (click)="createNote()"
          type="button"
          class="px-5 py-2 rounded-lg bg-primary text-white font-semibold hover:bg-primary/90 hover:scale-105 active:scale-95 transition-all duration-200 cursor-pointer"
        >
          {{ isEditMode() ? 'Save Changes' : 'Create Note' }}
        </button>
      </div>
    </form>
  </div>
</div>
